# API ТН ВЭД ТКС

Программный интерфейс предназначен для получения информации (ставки пошлин, акциза, особенности) по кодам ТН ВЭД ЕАЭС.

## Запросы

Запрос на получение текущей версии:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/ver.json

Запрос на получение списка кодов:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/

Запрос на получение справки по товару:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/<код ТН ВЭД>.json

Запрос на получение информации по всем кодам в виде ZIP-архива:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/archive.zip

где

    <ключ клиента> - (*+)  
    <код ТН ВЭД> - (\d{10})

## Сценарии использования

В случае, если информация по конкретному коду либо небольшому набору кодов ТН ВЭД требуется периодически, клиент обращается к API с запросами вида:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/<код ТН ВЭД>.json

Полученная информация будет актуальна на момент получения запроса сервером.

В случае, если информация загружается во внутреннюю систему для дальнейшего использования, клиент с некоторой периодичностью (например, один раз в час) загружает файл с номером версии. Если полученный номер версии больше, чем сохранённый ранее, клиент скачивает ZIP-архив, содержащий в себе информацию о всех кодах ТН ВЭД и о номере версии. Для этого используются запросы вида:

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/ver.json

    https://api1.tks.ru/tnved.json/json/<ключ клиента>/archive.zip

## Описание структуры ТН ВЭД ТКС

ТН ВЭД содержит информацию о кодах, их наименованиях, ставках и признаках.

Структурная схема информации по коду содержится в файле [schema.json](schema.json).

Информация по коду содержит в себе наименование, коды единиц измерения, информацию о базовых ставках/признаках, информацию о наличии альтернативных значений ставок, собственно значения альтернативных ставок.

Ставки делятся на типы. Каждому типу присвоен номер (PRIZNAK). Список типов содержится в файле [schema.json](schema.json) в описании поля TNVEDALL.

Каждый тип ставок по коду делится на базовое значение и примечания (альтернативые значения). Базовое значение ставки применяется к коду безусловно, в то время как альтернативные значения применяются согласно некоторому уточнению, которое содержится в поле NOTE, либо исходя из страны происхождения товара. Под страной имеется ввиду либо конкретная страна, либо некий ареал (совокупность стран, например, ЕАЭС). Описание кодов стран находится в файле [oksmt.json](oksmt.json). Описание кодов экономических ареалов находится в файле [ek_ar.json](ek_ar.json).

Ставки - это набор одного или нескольких цифровых значений с указанием единиц измерения и набор операций над ними. Ставки бывают адвалорные (начисляемые в процентах к таможенной стоимости облагаемых товаров), специфические (начисляемые в установленном размере за единицу облагаемых товаров), комбинированные (сочетающие оба вида таможенного обложения). Единицы измерения специфической ставки - это некоторое денежные единицы взятые за единицу измерения количества.

Описание Единиц измерения находится в файле [edizm.json](edizm.json).

Описания Единиц измерения Ставки можно найти в файле [tnvlook.json](tnvlook.json).

Код единицы измерения Ставки содердит Код единицы измерения количества (например, 166 (КГ)) и указание на валюту. D - Доллар США. Р (русская Р) - рубли. Если валюта не указана, то имеется ввиду Евро. Код 1 соотвествует адвалорной ставке.

Алгоритм определения Ставки (здесь и далее указаны наименования полей, описанные в [Структурной схеме](schema.json)):

* Если IMP != 0:
  * Ставка = "IMP IMPEDI"
  * Если IMPSIGN != None:
    * Если IMPSIGN == '>': Ставка += ", но не менее IMP2 IMPEDI2"
    * Иначе Если IMPSIGN == '<': Ставка += ", но не более IMP2 IMPEDI2"
    * Иначе Если IMPSIGN == '+': Ставка += "плюс IMP2 IMPEDI2"
    * Если IMPSIGN2 == '>': Ставка += ", но не менее IMP3 IMPEDI3"
    * Иначе Если IMPSIGN2 == '<': Ставка += ", но не более IMP3 IMPEDI3"
    * Иначе Если IMPSIGN2 == '+': Ставка += "плюс IMP3 IMPEDI23
* Иначе
  * Ставка = "нет"


PRIZNAK - это некоторое значение (пошлина, акциз, НДС, сертифицируется, лицензируется и пр.).

Для PRIZNAK=3 (НДС) действует соедующий алгоритм определения ставки:

* Если MIN == None: "нет"
* Если MIN == 0 и PREF != ('О', 'ОО', None): "0 % (условно по преф. PREF)"
* Если MIN > 0 и PREF != ('О', 'ОО', None):
  * Если PREF == ('ЛД', 'ЛК', 'ЛМ', 'ЛП', 'ЛС', 'ПЖ', 'ЛО', 'ЛЯ'): "MIN % (с указанием преф. PREF)"
  * Иначе: "0 % (условно по преф. PREF)"
* Иначе: "MIN %"

Информация по прочим особенностям (PRIZNAK=15) делится на подгруппы в соответствии со значением поля TYPEMIN. Описания подгрупп можно найти в файле [tnvlook.json](tnvlook.json).

